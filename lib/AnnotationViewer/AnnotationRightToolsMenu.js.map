{"version":3,"sources":["../../src/AnnotationViewer/AnnotationRightToolsMenu.js"],"names":["AnnotationRightToolsMenu","props","state","message","getSuccess","bind","getError","getNoAnnotation","annotations","annotationDivs","saveAnnotations","length","map","annotation","Object","assign","text","textId","result","post","action","send","set","end","err","res","ok","reject","body","resolve","then","error","setState","timer","setTimeout","toString","divStyles","zIndex","position","background","left","top","fontSize","button","gray","handleSaveButtonClick","module","exports"],"mappings":";;;;;;AAAA;;;;AAGA;;;;AAEA;;;;AACA;;;;;;;;;;;;IAEMA,wB;;;AAEL,mCAAYC,KAAZ,EAAmB;AAAA;;AAAA,kJACZA,KADY;;AAElB,QAAKC,KAAL,GAAa;AACZC,YAAS;AADG,GAAb;AAGA,QAAKC,UAAL,GAAkB,MAAKA,UAAL,CAAgBC,IAAhB,OAAlB;AACA,QAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcD,IAAd,OAAhB;AACA,QAAKE,eAAL,GAAuB,MAAKA,eAAL,CAAqBF,IAArB,OAAvB;AAPkB;AAQlB;;;;0CAEuB;AAAA;;AACvB,OAAIG,cAAc,KAAKP,KAAL,CAAWO,WAA7B;AAAA,OACCC,iBAAiB,KAAKR,KAAL,CAAWQ,cAD7B;AAAA,OAECC,kBAAkB,EAFnB;;AAIA,OAAIF,YAAYG,MAAZ,GAAqB,CAAzB,EAA4B;AAC3BD,sBAAkBF,YAAYI,GAAZ,CAAgB,UAACC,UAAD,EAAgB;AACjD,YAAOC,OAAOC,MAAP,CAAc,EAAd,eACHF,UADG;AAENG,YAAMP,eAAeI,WAAWI,MAA1B,EAAkCD;AAFlC,QAAP;AAIA,KALiB,CAAlB;;AAOA,QAAIE,SAAS,qBACRC,IADQ,CACH,KAAKlB,KAAL,CAAWmB,MADR,EAERC,IAFQ,CAEHX,eAFG,EAGRY,GAHQ,CAGJ,QAHI,EAGM,kBAHN,EAIRC,GAJQ,CAIJ,UAACC,GAAD,EAAMC,GAAN,EAAc;AAClB,SAAGD,OAAO,CAACC,IAAIC,EAAf,EAAmB;AAClBC,aAAOF,IAAIG,IAAJ,IAAYJ,GAAnB;AACA,MAFD,MAEO;AACNK,cAAQJ,IAAIG,IAAZ;AACA;AACD,KAVQ,CAAb;;AAYAV,WAAOY,IAAP,CAAY,UAACZ,MAAD,EAAY;AAAC,YAAKd,UAAL,CAAgBc,MAAhB;AAAwB,KAAjD,EACE,UAACa,KAAD,EAAW;AAAC,YAAKzB,QAAL,CAAcyB,KAAd;AAAqB,KADnC;AAEA,IAtBD,MAsBO;AACN,SAAKxB,eAAL;AACA;AAED;;;6BAEUW,M,EAAQ;AAAA;;AAClB,QAAKc,QAAL,CAAc;AACb7B,aAAS,6DAAmB,SAASe,OAAOU,IAAnC;AADI,IAAd;AAGA,QAAKK,KAAL,GAAaC,WACZ;AAAA,WAAM,OAAKF,QAAL,CAAc;AACnB7B,cAAS;AADU,KAAd,CAAN;AAAA,IADY,EAGR,IAHQ,CAAb;AAKA;;;2BAEQ4B,K,EAAO;AAAA;;AACf,QAAKC,QAAL,CAAc;AACb7B,aAAS,6DAAmB,SAAS4B,MAAMI,QAAN,EAA5B;AADI,IAAd;AAGA,QAAKF,KAAL,GAAaC,WACZ;AAAA,WAAM,OAAKF,QAAL,CAAc;AACnB7B,cAAS;AADU,KAAd,CAAN;AAAA,IADY,EAGR,IAHQ,CAAb;AAKA;;;oCAEiB;AAAA;;AACjB,QAAK6B,QAAL,CAAc;AACb7B,aAAS,6DAAmB,SAAQ,wDAA3B;AADI,IAAd;AAGA,QAAK8B,KAAL,GAAaC,WACZ;AAAA,WAAM,OAAKF,QAAL,CAAc;AACnB7B,cAAS;AADU,KAAd,CAAN;AAAA,IADY,EAGR,IAHQ,CAAb;AAKA;;;2BAEQ;;AAER,OAAMiC,YAAY;AACjBC,YAAQ,EADS;AAEjBC,cAAU,OAFO;AAGjBC,gBAAY,aAHK;AAIjBC,UAAM,KAAKvC,KAAL,CAAWuC,IAJA;AAKjBC,SAAK,KAAKxC,KAAL,CAAWwC,GALC;AAMjBC,cAAU;AANO,IAAlB;;AASA,UACC;AAAA;AAAA,MAAK,OAAON,SAAZ;AACC;AAAA;AAAA,OAAQ,WAAW,iBAAOO,MAAP,GAAgB,GAAhB,GAAsB,iBAAOC,IAAhD;AACE,eAAS,KAAKC,qBAAL,CAA2BxC,IAA3B,CAAgC,IAAhC,CADX;AAAA;AAAA,KADD;AAGG,SAAKH,KAAL,CAAWC,OAAX,IAAsB,IAAtB,GAA6B,EAA7B,GAAkC,KAAKD,KAAL,CAAWC;AAHhD,IADD;AAOA;;;;;;AAGF2C,OAAOC,OAAP,GAAiB/C,wBAAjB","file":"AnnotationRightToolsMenu.js","sourcesContent":["import React, {\n\tComponent\n} from 'react';\nimport superagent from 'superagent';\n\nimport AnnotationMessage from './AnnotationMessage';\nimport styles from '../css/viewer.css';\n\nclass AnnotationRightToolsMenu extends Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tmessage: null\n\t\t}\n\t\tthis.getSuccess = this.getSuccess.bind(this);\n\t\tthis.getError = this.getError.bind(this);\n\t\tthis.getNoAnnotation = this.getNoAnnotation.bind(this);\n\t}\n\n\thandleSaveButtonClick() {\n\t\tvar annotations = this.props.annotations,\n\t\t\tannotationDivs = this.props.annotationDivs,\n\t\t\tsaveAnnotations = [];\n\n\t\tif (annotations.length > 0) {\n\t\t\tsaveAnnotations = annotations.map((annotation) => {\n\t\t\t\treturn Object.assign({},{\n\t\t\t\t\t...annotation,\n\t\t\t\t\ttext: annotationDivs[annotation.textId].text\n\t\t\t\t})\n\t\t\t})\n\n\t\t\tvar result = superagent\n\t\t\t\t\t\t\t.post(this.props.action)\n\t\t\t\t\t\t\t.send(saveAnnotations)\n\t\t\t\t\t\t\t.set('Accept', 'application/json')\n\t\t\t\t\t\t\t.end((err, res) => {\n\t\t\t\t\t\t\t\tif(err || !res.ok) {\n\t\t\t\t\t\t\t\t\treject(res.body || err)\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresolve(res.body)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\n\t\t\tresult.then((result) => {this.getSuccess(result)}, \n\t\t\t\t\t(error) => {this.getError(error)})\n\t\t} else {\n\t\t\tthis.getNoAnnotation();\n\t\t}\n\n\t}\n\n\tgetSuccess(result) {\n\t\tthis.setState({\n\t\t\tmessage: <AnnotationMessage message={result.body} />\n\t\t})\n\t\tthis.timer = setTimeout(\n\t\t\t() => this.setState({\n\t\t\t\tmessage: null\n\t\t\t}), 2000\n\t\t)\n\t}\n\n\tgetError(error) {\n\t\tthis.setState({\n\t\t\tmessage: <AnnotationMessage message={error.toString()} />\n\t\t})\n\t\tthis.timer = setTimeout(\n\t\t\t() => this.setState({\n\t\t\t\tmessage: null\n\t\t\t}), 2000\n\t\t)\n\t}\n\n\tgetNoAnnotation() {\n\t\tthis.setState({\n\t\t\tmessage: <AnnotationMessage message=\"没有注解，无需保存\" />\n\t\t})\n\t\tthis.timer = setTimeout(\n\t\t\t() => this.setState({\n\t\t\t\tmessage: null\n\t\t\t}), 2000\n\t\t)\n\t}\n\n\trender() {\n\n\t\tconst divStyles = {\n\t\t\tzIndex: 20,\n\t\t\tposition: 'fixed',\n\t\t\tbackground: 'transparent',\n\t\t\tleft: this.props.left,\n\t\t\ttop: this.props.top,\n\t\t\tfontSize: '10px'\n\t\t}\n\n\t\treturn (\n\t\t\t<div style={divStyles}>\n\t\t\t\t<button\tclassName={styles.button + ' ' + styles.gray}\n\t\t\t\t\t\tonClick={this.handleSaveButtonClick.bind(this)}>保存</button>\n\t\t\t\t{ this.state.message == null ? \"\" : this.state.message}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nmodule.exports = AnnotationRightToolsMenu;"]}