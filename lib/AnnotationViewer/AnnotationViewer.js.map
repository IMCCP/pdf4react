{"version":3,"sources":["../../src/AnnotationViewer/AnnotationViewer.js"],"names":["AnnotationViewer","props","state","startX","startY","ctx","interfaceCtx","linesCtx","mouseDown","clearRect","textDivs","annotations","annotationDivs","textId","color","canvas","findDOMNode","annotationInterfaceCanvas","interfaceCanvas","annotationLineCanvas","height","viewport","pagesCount","Math","floor","width","lineTextWidth","getContext","setState","e","preventDefault","pageX","offsetLeft","pageY","offsetTop","endX","endY","beginPath","closePath","fillStyle","fillRect","handleDrawLineToText","concat","type","location","textDivStyle","lineStartX","left","decWidth","top","moveTo","lineTo","strokeStyle","stroke","handleOnCloseTextDiv","bind","Object","assign","id","deleLine","lineWidth","textDivsTemp","filter","key","annotationsTemp","filterAnnotation","handleDeleLineToText","annotationCanvasStyle","position","zIndex","opacity","margin","borderLeft","borderRight","borderTop","borderStyle","borderColor","annotationLineCanvasStyle","annotationsInterfaceCanvas","handleOnColorChanged","c","handleOnMouseDown","handleOnMouseUp","handleOnMouseDownMove","handleOnContextMenu","map","defaultProps","module","exports"],"mappings":";;;;;;AAAA;;;;AAGA;;;;AAEA;;;;AACA;;;;AAEA;;;;;;;;;;;;;;IAEMA,gB;;;AAEL,2BAAYC,KAAZ,EAAmB;AAAA;;AAAA,kIACZA,KADY;;AAElB,QAAKC,KAAL,GAAa;AACZC,WAAQ,IADI;AAEZC,WAAQ,IAFI;AAGZC,QAAK,IAHO;AAIZC,iBAAc,IAJF;AAKZC,aAAU,IALE;AAMZC,cAAW,KANC;AAOZC,cAAW,IAPC;AAQZC,aAAU,EARE;AASZC,gBAAa,EATD;AAUZC,mBAAgB,EAVJ;AAWZC,WAAQ,CAXI;AAYZC,UAAO;AAZK,GAAb;AAFkB;AAgBlB;;;;sCAEmB;AACnB,OAAIC,SAAS,mBAASC,WAAT,CAAqB,KAAKD,MAA1B,CAAb;AAAA,OACCE,4BAA4B,mBAASD,WAAT,CAAqB,KAAKE,eAA1B,CAD7B;AAAA,OAECC,uBAAuB,mBAASH,WAAT,CAAqB,KAAKG,oBAA1B,CAFxB;AAAA,OAGCC,SAAS,KAAKnB,KAAL,CAAWoB,QAAX,CAAoBD,MAApB,GAA6B,KAAKnB,KAAL,CAAWqB,UAAxC,GACT,CAAC,KAAKrB,KAAL,CAAWqB,UAAX,GAAwB,CAAzB,IAA8B,CAJ/B;;AAMAP,UAAOK,MAAP,GAAgBG,KAAKC,KAAL,CAAWJ,MAAX,CAAhB;AACAL,UAAOU,KAAP,GAAeF,KAAKC,KAAL,CAAW,KAAKvB,KAAL,CAAWoB,QAAX,CAAoBI,KAA/B,CAAf;AACAR,6BAA0BG,MAA1B,GAAmCL,OAAOK,MAA1C;AACAH,6BAA0BQ,KAA1B,GAAkCV,OAAOU,KAAzC;AACAN,wBAAqBC,MAArB,GAA8BG,KAAKC,KAAL,CAAWJ,MAAX,CAA9B;AACAD,wBAAqBM,KAArB,GAA6BF,KAAKC,KAAL,CAAW,KAAKvB,KAAL,CAAWoB,QAAX,CAAoBI,KAA/B,IAAwC,KAAKxB,KAAL,CAAWyB,aAAhF;AACA,OAAIrB,MAAMU,OAAOY,UAAP,CAAkB,IAAlB,CAAV;AACA,OAAIpB,WAAWY,qBAAqBQ,UAArB,CAAgC,IAAhC,CAAf;AACA,OAAIT,kBAAkBD,0BAA0BU,UAA1B,CAAqC,IAArC,CAAtB;AACA,QAAKC,QAAL,CAAc;AACbvB,YADa;AAEbE,sBAFa;AAGbW;AAHa,IAAd;AAKA;;;oCAEiBW,C,EAAG;AACpBA,KAAEC,cAAF;AACA,QAAKF,QAAL,CAAc;AACbzB,YAAQ0B,EAAEE,KAAF,GAAU,KAAKhB,MAAL,CAAYiB,UADjB;AAEb5B,YAAQyB,EAAEI,KAAF,GAAU,CAAV,GAAc,KAAKlB,MAAL,CAAYmB,SAFrB;AAGb1B,eAAW;AAHE,IAAd;AAKA;;;kCAEeqB,C,EAAG;AAClB,OAAIM,OAAON,EAAEE,KAAF,GAAU,KAAKhB,MAAL,CAAYiB,UAAjC;AAAA,OACCI,OAAOP,EAAEI,KAAF,GAAU,CAAV,GAAc,KAAKlB,MAAL,CAAYmB,SADlC;;AAGA,OAAI,KAAKhC,KAAL,CAAWC,MAAX,IAAqBgC,IAArB,IAA6B,KAAKjC,KAAL,CAAWE,MAAX,IAAqBgC,IAAlD,IAA0D,KAAKlC,KAAL,CAAWM,SAAzE,EAAoF;AACnF,SAAKN,KAAL,CAAWgB,eAAX,CAA2BmB,SAA3B;AACA,SAAKnC,KAAL,CAAWgB,eAAX,CAA2BT,SAA3B,CAAqC,CAArC,EAAwC,CAAxC,EAA2C,KAAKS,eAAL,CAAqBO,KAAhE,EAAuE,KAAKP,eAAL,CAAqBE,MAA5F;AACA,SAAKlB,KAAL,CAAWgB,eAAX,CAA2BoB,SAA3B;;AAEA,SAAKpC,KAAL,CAAWG,GAAX,CAAegC,SAAf;AACA,SAAKnC,KAAL,CAAWG,GAAX,CAAekC,SAAf,GAA2B,KAAKrC,KAAL,CAAWY,KAAtC;AACA,SAAKZ,KAAL,CAAWG,GAAX,CAAemC,QAAf,CAAwB,KAAKtC,KAAL,CAAWC,MAAnC,EAA2C,KAAKD,KAAL,CAAWE,MAAtD,EACC+B,OAAO,KAAKjC,KAAL,CAAWC,MADnB,EAC2BiC,OAAO,KAAKlC,KAAL,CAAWE,MAD7C;AAEA,SAAKF,KAAL,CAAWG,GAAX,CAAeiC,SAAf;AACA,SAAKG,oBAAL,CAA0B,KAAKvC,KAAL,CAAWC,MAArC,EAA6C,KAAKD,KAAL,CAAWE,MAAxD,EACC+B,IADD,EACOC,IADP;;AAGA,SAAKR,QAAL,CAAc;AACbjB,kBAAa,KAAKT,KAAL,CAAWS,WAAX,CAAuB+B,MAAvB,CAA8B;AAC1CC,YAAM,MADoC;AAE1CC,gBAAU;AACTzC,eAAQ,KAAKD,KAAL,CAAWC,MADV;AAETC,eAAQ,KAAKF,KAAL,CAAWE,MAFV;AAGT+B,aAAMA,IAHG;AAITC,aAAMA;AAJG,OAFgC;AAQ1CvB,cAAQ,KAAKX,KAAL,CAAWW,MARuB;AAS1CC,aAAO,KAAKZ,KAAL,CAAWY;AATwB,MAA9B,CADA;AAYbN,gBAAW,KAZE;AAabK,aAAQ,KAAKX,KAAL,CAAWW,MAAX,GAAoB,CAbf;AAcbJ,gBAAW;AAdE,KAAd;AAgBA;AACD;;;wCAEqBoB,C,EAAG;AACxB,OAAI,KAAK3B,KAAL,CAAWM,SAAf,EAA0B;AACzB,QAAI2B,OAAON,EAAEE,KAAF,GAAU,KAAKhB,MAAL,CAAYiB,UAAtB,GAAmC,KAAK9B,KAAL,CAAWC,MAAzD;AAAA,QACCiC,OAAOP,EAAEI,KAAF,GAAU,KAAKlB,MAAL,CAAYmB,SAAtB,GAAkC,CAAlC,GAAsC,KAAKhC,KAAL,CAAWE,MADzD;AAEA,SAAKF,KAAL,CAAWgB,eAAX,CAA2BmB,SAA3B;AACA,QAAI,KAAKnC,KAAL,CAAWO,SAAX,IAAwB,IAA5B,EAAkC;AACjC,UAAKP,KAAL,CAAWgB,eAAX,CAA2BT,SAA3B,CAAqC,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CAArC,EAA8D,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CAA9D,EACC,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CADD,EAC0B,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CAD1B;AAEA,UAAKmB,QAAL,CAAc;AACbnB,iBAAW,CAAC,KAAKP,KAAL,CAAWC,MAAZ,EAAoB,KAAKD,KAAL,CAAWE,MAA/B,EAAuC+B,IAAvC,EAA6CC,IAA7C;AADE,MAAd;AAGA,KAND,MAMO;AACN,UAAKR,QAAL,CAAc;AACbnB,iBAAW,CAAC,KAAKP,KAAL,CAAWC,MAAZ,EAAoB,KAAKD,KAAL,CAAWE,MAA/B,EAAuC+B,IAAvC,EAA6CC,IAA7C;AADE,MAAd;AAGA;AACD,SAAKlC,KAAL,CAAWgB,eAAX,CAA2BqB,SAA3B,GAAuC,KAAKrC,KAAL,CAAWY,KAAlD;AACA,SAAKZ,KAAL,CAAWgB,eAAX,CAA2BsB,QAA3B,CAAoC,KAAKtC,KAAL,CAAWC,MAA/C,EAAuD,KAAKD,KAAL,CAAWE,MAAlE,EACC+B,IADD,EACOC,IADP;AAEA,SAAKlC,KAAL,CAAWgB,eAAX,CAA2BoB,SAA3B;AACA;AACD;;;uCAEoBnC,M,EAAQC,M,EAAQ+B,I,EAAMC,I,EAAM;AAChD,OAAIS,eAAe,EAAnB;AAAA,OACCb,aAAa,KAAKb,oBAAL,CAA0Ba,UADxC;AAAA,OAECc,aAAa3C,SAASgC,IAAT,GAAgBhC,MAAhB,GAAyBgC,IAFvC;AAGAU,gBAAaE,IAAb,GAAoB,KAAK5B,oBAAL,CAA0BM,KAA1B,IAAmC,KAAKvB,KAAL,CAAWW,MAAX,GAAoB,CAApB,IAAyB,CAAzB,GAA6B,CAA7B,GAAiC,KAAKZ,KAAL,CAAW+C,QAA/E,CAApB;AACAH,gBAAaI,GAAb,GAAmBb,OAAO,CAACA,OAAOhC,MAAR,IAAkB,CAA5C;;AAEA,QAAKF,KAAL,CAAWK,QAAX,CAAoB8B,SAApB;AACA,QAAKnC,KAAL,CAAWK,QAAX,CAAoB2C,MAApB,CAA2BJ,UAA3B,EAAuCV,OAAO,CAACA,OAAOhC,MAAR,IAAkB,CAAhE;AACA,QAAKF,KAAL,CAAWK,QAAX,CAAoB4C,MAApB,CAA2BN,aAAaE,IAAxC,EAA8CF,aAAaI,GAA3D;AACA,QAAK/C,KAAL,CAAWK,QAAX,CAAoB6C,WAApB,GAAkC,KAAKlD,KAAL,CAAWY,KAA7C;AACA,QAAKZ,KAAL,CAAWK,QAAX,CAAoB8C,MAApB;AACA,QAAKnD,KAAL,CAAWK,QAAX,CAAoB+B,SAApB;;AAEA,QAAKV,QAAL,CAAc;AACblB,cAAU,KAAKR,KAAL,CAAWQ,QAAX,CAAoBgC,MAApB,CACT,0DAAgB,KAAK,KAAKxC,KAAL,CAAWW,MAAhC;AACC,SAAI,KAAKX,KAAL,CAAWW,MADhB;AAEC,WAAMgC,aAAaE,IAFpB;AAGC,UAAKF,aAAaI,GAHnB;AAIC,iBAAYjB,UAJb;AAKC,YAAO,KAAK9B,KAAL,CAAWY,KALnB;AAMC,qBAAgB,KAAKwC,oBAAL,CAA0BC,IAA1B,CAA+B,IAA/B,CANjB,GADS,CADG;AASb3C,oBAAgB4C,OAAOC,MAAP,CAAc,EAAd,eACZ,KAAKvD,KAAL,CAAWU,cADC,sBAEd,KAAKV,KAAL,CAAWW,MAFG,EAEM;AACpBkC,WAAMF,aAAaE,IADC;AAEpBE,UAAKJ,aAAaI,GAFE;AAGpBH,iBAAYA;AAHQ,KAFN;AATH,IAAd;AAkBA;;;uCAEoBY,E,EAAI;AACxB,OAAIC,WAAW,KAAKzD,KAAL,CAAWU,cAAX,CAA0B8C,EAA1B,CAAf;AACA,QAAKxD,KAAL,CAAWK,QAAX,CAAoB8B,SAApB;AACA,QAAKnC,KAAL,CAAWK,QAAX,CAAoBE,SAApB,CAA8BkD,SAASb,UAAvC,EAAmDa,SAASV,GAAT,GAAe,KAAK/C,KAAL,CAAWK,QAAX,CAAoBqD,SAAtF,EACCD,SAASZ,IADV,EACgB,KAAK7C,KAAL,CAAWK,QAAX,CAAoBqD,SAApB,GAAgC,CADhD;AAEA,QAAK1D,KAAL,CAAWK,QAAX,CAAoB+B,SAApB;AACA;;;sCAEmBT,C,EAAG;AACtBA,KAAEC,cAAF;AACA,OAAI,KAAK5B,KAAL,CAAWM,SAAf,EAA0B;AACzB,QAAI2B,OAAON,EAAEE,KAAF,GAAU,KAAKhB,MAAL,CAAYiB,UAAtB,GAAmC,KAAK9B,KAAL,CAAWC,MAAzD;AAAA,QACCiC,OAAOP,EAAEI,KAAF,GAAU,KAAKlB,MAAL,CAAYmB,SAAtB,GAAkC,CAAlC,GAAsC,KAAKhC,KAAL,CAAWE,MADzD;AAEA,QAAI,KAAKF,KAAL,CAAWO,SAAX,IAAwB,IAA5B,EAAkC;AACjC,UAAKP,KAAL,CAAWG,GAAX,CAAegC,SAAf;AACA,UAAKnC,KAAL,CAAWG,GAAX,CAAeI,SAAf,CAAyB,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CAAzB,EAAkD,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CAAlD,EACC,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CADD,EAC0B,KAAKP,KAAL,CAAWO,SAAX,CAAqB,CAArB,CAD1B;AAEA,UAAKP,KAAL,CAAWG,GAAX,CAAeiC,SAAf;AACA,UAAKV,QAAL,CAAc;AACbnB,iBAAW,CAAC,KAAKP,KAAL,CAAWC,MAAZ,EAAoB,KAAKD,KAAL,CAAWE,MAA/B,EAAuC+B,IAAvC,EAA6CC,IAA7C;AADE,MAAd;AAGA,KARD,MAQO;AACN,UAAKR,QAAL,CAAc;AACbnB,iBAAW,CAAC,KAAKP,KAAL,CAAWC,MAAZ,EAAoB,KAAKD,KAAL,CAAWE,MAA/B,EAAuC+B,IAAvC,EAA6CC,IAA7C;AADE,MAAd;AAGA;AACD;AACD,QAAKR,QAAL,CAAc;AACbpB,eAAW;AADE,IAAd;AAGA;;;uCAEoBkD,E,EAAI;;AAExB,OAAIG,eAAe,KAAK3D,KAAL,CAAWQ,QAAX,CAAoBoD,MAApB,CAA2B,UAACjC,CAAD,EAAO;AACnD,WAAOA,EAAEkC,GAAF,IAASL,EAAhB;AACA,IAFiB,CAAnB;AAAA,OAGCM,kBAAkB,KAAK9D,KAAL,CAAWS,WAAX,CAAuBmD,MAAvB,CAA8B,UAACjC,CAAD,EAAO;AACtD,WAAOA,EAAEhB,MAAF,IAAY6C,EAAnB;AACA,IAFiB,CAHnB;AAMA,OAAIO,mBAAmB,KAAK/D,KAAL,CAAWS,WAAX,CAAuBmD,MAAvB,CAA8B,UAACjC,CAAD,EAAO;AAC3D,WAAOA,EAAEhB,MAAF,IAAY6C,EAAnB;AACA,IAFsB,EAEpB,CAFoB,CAAvB;AAGA,QAAKxD,KAAL,CAAWG,GAAX,CAAegC,SAAf;AACA,QAAKnC,KAAL,CAAWG,GAAX,CAAeI,SAAf,CAAyBwD,iBAAiBrB,QAAjB,CAA0BzC,MAAnD,EACC8D,iBAAiBrB,QAAjB,CAA0BxC,MAD3B,EAEC6D,iBAAiBrB,QAAjB,CAA0BT,IAA1B,GAAiC8B,iBAAiBrB,QAAjB,CAA0BzC,MAF5D,EAGC8D,iBAAiBrB,QAAjB,CAA0BR,IAA1B,GAAiC6B,iBAAiBrB,QAAjB,CAA0BxC,MAH5D;AAKA,QAAKF,KAAL,CAAWG,GAAX,CAAeiC,SAAf;AACA,QAAK4B,oBAAL,CAA0BR,EAA1B;;AAEA,QAAK9B,QAAL,CAAc;AACblB,cAAUmD,YADG;AAEblD,iBAAaqD,eAFA;AAGbvD,eAAW;AAHE,IAAd;AAKA;;;uCAEoBK,K,EAAO;AAC3B,QAAKc,QAAL,CAAc;AACbd;AADa,IAAd;AAGA;;;2BAEQ;AAAA;;AAER,OAAMqD,wBAAwB;AAC7BC,cAAU,UADmB;AAE7BC,YAAQ,EAFqB;AAG7BC,aAAS,KAAKrE,KAAL,CAAWqE,OAHS;AAI7BC,YAAQ,oBAJqB;AAK7BC,gBAAY,KALiB;AAM7BC,iBAAa,KANgB;AAO7BC,eAAW,KAPkB;AAQ7BC,iBAAa,OARgB;AAS7BC,iBAAa;AATgB,IAA9B;;AAYA,OAAMC,4BAA4B;AACjCT,cAAU,UADuB;AAEjCC,YAAQ,CAFyB;AAGjCC,aAAS,KAAKrE,KAAL,CAAWqE,OAHa;AAIjCC,YAAQ,oBAJyB;AAKjCC,gBAAY,KALqB;AAMjCC,iBAAa,KANoB;AAOjCC,eAAW,KAPsB;AAQjCC,iBAAa,OARoB;AASjCC,iBAAa;AAToB,IAAlC;;AAYA,OAAME,6BAA6B;AAClCV,cAAU,UADwB;AAElCC,YAAQ,EAF0B;AAGlCC,aAAS,KAAKrE,KAAL,CAAWqE,OAHc;AAIlCC,YAAQ,oBAJ0B;AAKlCC,gBAAY,KALsB;AAMlCC,iBAAa,KANqB;AAOlCC,eAAW,KAPuB;AAQlCC,iBAAa,OARqB;AASlCC,iBAAa;AATqB,IAAnC;;AAYA,UACC;AAAA;AAAA;AACC,mEAAqB,qBAAqB,KAAKG,oBAAL,CAA0BxB,IAA1B,CAA+B,IAA/B,CAA1C,GADD;AAGC,8CAAQ,KAAK,aAACyB,CAAD;AAAA,aAAO,OAAKjE,MAAL,GAAciE,CAArB;AAAA,MAAb;AACE,YAAOb;AADT,MAHD;AAOC,8CAAQ,KAAK,aAACa,CAAD;AAAA,aAAO,OAAK9D,eAAL,GAAuB8D,CAA9B;AAAA,MAAb;AACE,YAAOb,qBADT;AAEE,kBAAa,KAAKc,iBAAL,CAAuB1B,IAAvB,CAA4B,IAA5B,CAFf;AAGE,gBAAW,KAAK2B,eAAL,CAAqB3B,IAArB,CAA0B,IAA1B,CAHb;AAIE,kBAAa,KAAK4B,qBAAL,CAA2B5B,IAA3B,CAAgC,IAAhC,CAJf;AAKE,oBAAe,KAAK6B,mBAAL,CAAyB7B,IAAzB,CAA8B,IAA9B;AALjB,MAPD;AAeC,8CAAQ,KAAK,aAACyB,CAAD;AAAA,aAAO,OAAK7D,oBAAL,GAA4B6D,CAAnC;AAAA,MAAb;AACE,YAAOH;AADT,MAfD;AAmBC;AAAA;AAAA,OAAK,OAAO,EAACT,UAAS,UAAV,EAAZ;AACE,UAAKlE,KAAL,CAAWQ,QAAX,CAAoB2E,GAApB,CAAwB,UAACxD,CAAD;AAAA,aAAOA,CAAP;AAAA,MAAxB;AADF;AAnBD,IADD;AAyBA;;;;;;AAGF7B,iBAAiBsF,YAAjB,GAAgC;AAC/BtC,WAAU;AADqB,CAAhC;;AAIAuC,OAAOC,OAAP,GAAiBxF,gBAAjB","file":"AnnotationViewer.js","sourcesContent":["import React, {\n\tComponent\n} from 'react';\nimport ReactDOM from 'react-dom';\n\nimport AnnotationText from './AnnotationText';\nimport AnnotationToolsMenu from './AnnotationToolsMenu';\n\nimport FontFace from '../css/font-face.css';\n\nclass AnnotationViewer extends Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tstartX: null,\n\t\t\tstartY: null,\n\t\t\tctx: null,\n\t\t\tinterfaceCtx: null,\n\t\t\tlinesCtx: null,\n\t\t\tmouseDown: false,\n\t\t\tclearRect: null,\n\t\t\ttextDivs: [],\n\t\t\tannotations: [],\n\t\t\tannotationDivs: {},\n\t\t\ttextId: 0,\n\t\t\tcolor: 'rgba(0, 128, 0, 0.5)'\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tvar canvas = ReactDOM.findDOMNode(this.canvas),\n\t\t\tannotationInterfaceCanvas = ReactDOM.findDOMNode(this.interfaceCanvas),\n\t\t\tannotationLineCanvas = ReactDOM.findDOMNode(this.annotationLineCanvas),\n\t\t\theight = this.props.viewport.height * this.props.pagesCount +\n\t\t\t(this.props.pagesCount - 1) * 9;\n\n\t\tcanvas.height = Math.floor(height);\n\t\tcanvas.width = Math.floor(this.props.viewport.width);\n\t\tannotationInterfaceCanvas.height = canvas.height;\n\t\tannotationInterfaceCanvas.width = canvas.width;\n\t\tannotationLineCanvas.height = Math.floor(height);\n\t\tannotationLineCanvas.width = Math.floor(this.props.viewport.width) + this.props.lineTextWidth;\n\t\tvar ctx = canvas.getContext(\"2d\");\n\t\tvar linesCtx = annotationLineCanvas.getContext(\"2d\");\n\t\tvar interfaceCanvas = annotationInterfaceCanvas.getContext(\"2d\");\n\t\tthis.setState({\n\t\t\tctx,\n\t\t\tlinesCtx,\n\t\t\tinterfaceCanvas\n\t\t});\n\t}\n\n\thandleOnMouseDown(e) {\n\t\te.preventDefault();\n\t\tthis.setState({\n\t\t\tstartX: e.pageX - this.canvas.offsetLeft,\n\t\t\tstartY: e.pageY - 9 - this.canvas.offsetTop,\n\t\t\tmouseDown: true\n\t\t})\n\t}\n\n\thandleOnMouseUp(e) {\n\t\tvar endX = e.pageX - this.canvas.offsetLeft,\n\t\t\tendY = e.pageY - 9 - this.canvas.offsetTop;\n\n\t\tif (this.state.startX != endX && this.state.startY != endY && this.state.mouseDown) {\n\t\t\tthis.state.interfaceCanvas.beginPath();\n\t\t\tthis.state.interfaceCanvas.clearRect(0, 0, this.interfaceCanvas.width, this.interfaceCanvas.height);\n\t\t\tthis.state.interfaceCanvas.closePath();\n\n\t\t\tthis.state.ctx.beginPath();\n\t\t\tthis.state.ctx.fillStyle = this.state.color;\n\t\t\tthis.state.ctx.fillRect(this.state.startX, this.state.startY,\n\t\t\t\tendX - this.state.startX, endY - this.state.startY);\n\t\t\tthis.state.ctx.closePath();\n\t\t\tthis.handleDrawLineToText(this.state.startX, this.state.startY,\n\t\t\t\tendX, endY);\n\n\t\t\tthis.setState({\n\t\t\t\tannotations: this.state.annotations.concat({\n\t\t\t\t\ttype: 'rect',\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\tstartX: this.state.startX,\n\t\t\t\t\t\tstartY: this.state.startY,\n\t\t\t\t\t\tendX: endX,\n\t\t\t\t\t\tendY: endY\n\t\t\t\t\t},\n\t\t\t\t\ttextId: this.state.textId,\n\t\t\t\t\tcolor: this.state.color\n\t\t\t\t}),\n\t\t\t\tmouseDown: false,\n\t\t\t\ttextId: this.state.textId + 1,\n\t\t\t\tclearRect: null\n\t\t\t})\n\t\t}\n\t}\n\n\thandleOnMouseDownMove(e) {\n\t\tif (this.state.mouseDown) {\n\t\t\tvar endX = e.pageX - this.canvas.offsetLeft - this.state.startX,\n\t\t\t\tendY = e.pageY - this.canvas.offsetTop - 9 - this.state.startY;\n\t\t\tthis.state.interfaceCanvas.beginPath();\n\t\t\tif (this.state.clearRect != null) {\n\t\t\t\tthis.state.interfaceCanvas.clearRect(this.state.clearRect[0], this.state.clearRect[1],\n\t\t\t\t\tthis.state.clearRect[2], this.state.clearRect[3])\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.state.interfaceCanvas.fillStyle = this.state.color;\n\t\t\tthis.state.interfaceCanvas.fillRect(this.state.startX, this.state.startY,\n\t\t\t\tendX, endY);\n\t\t\tthis.state.interfaceCanvas.closePath();\n\t\t}\n\t}\n\n\thandleDrawLineToText(startX, startY, endX, endY) {\n\t\tvar textDivStyle = {},\n\t\t\toffsetLeft = this.annotationLineCanvas.offsetLeft,\n\t\t\tlineStartX = startX > endX ? startX : endX;\n\t\ttextDivStyle.left = this.annotationLineCanvas.width - (this.state.textId % 2 == 0 ? 0 : this.props.decWidth);\n\t\ttextDivStyle.top = endY - (endY - startY) / 2;\n\n\t\tthis.state.linesCtx.beginPath();\n\t\tthis.state.linesCtx.moveTo(lineStartX, endY - (endY - startY) / 2);\n\t\tthis.state.linesCtx.lineTo(textDivStyle.left, textDivStyle.top);\n\t\tthis.state.linesCtx.strokeStyle = this.state.color;\n\t\tthis.state.linesCtx.stroke();\n\t\tthis.state.linesCtx.closePath();\n\n\t\tthis.setState({\n\t\t\ttextDivs: this.state.textDivs.concat(\n\t\t\t\t<AnnotationText key={this.state.textId} \n\t\t\t\t\tid={this.state.textId}\n\t\t\t\t\tleft={textDivStyle.left} \n\t\t\t\t\ttop={textDivStyle.top} \n\t\t\t\t\toffsetLeft={offsetLeft}\n\t\t\t\t\tcolor={this.state.color}\n\t\t\t\t\tonCloseTextDiv={this.handleOnCloseTextDiv.bind(this)}/>),\n\t\t\tannotationDivs: Object.assign({}, {\n\t\t\t\t...this.state.annotationDivs,\n\t\t\t\t[this.state.textId]: {\n\t\t\t\t\tleft: textDivStyle.left,\n\t\t\t\t\ttop: textDivStyle.top,\n\t\t\t\t\tlineStartX: lineStartX\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\thandleDeleLineToText(id) {\n\t\tvar deleLine = this.state.annotationDivs[id];\n\t\tthis.state.linesCtx.beginPath();\n\t\tthis.state.linesCtx.clearRect(deleLine.lineStartX, deleLine.top - this.state.linesCtx.lineWidth,\n\t\t\tdeleLine.left, this.state.linesCtx.lineWidth * 2);\n\t\tthis.state.linesCtx.closePath();\n\t}\n\n\thandleOnContextMenu(e) {\n\t\te.preventDefault();\n\t\tif (this.state.mouseDown) {\n\t\t\tvar endX = e.pageX - this.canvas.offsetLeft - this.state.startX,\n\t\t\t\tendY = e.pageY - this.canvas.offsetTop - 9 - this.state.startY;\n\t\t\tif (this.state.clearRect != null) {\n\t\t\t\tthis.state.ctx.beginPath();\n\t\t\t\tthis.state.ctx.clearRect(this.state.clearRect[0], this.state.clearRect[1],\n\t\t\t\t\tthis.state.clearRect[2], this.state.clearRect[3])\n\t\t\t\tthis.state.ctx.closePath();\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tthis.setState({\n\t\t\tmouseDown: false\n\t\t})\n\t}\n\n\thandleOnCloseTextDiv(id) {\n\n\t\tvar textDivsTemp = this.state.textDivs.filter((e) => {\n\t\t\t\treturn e.key != id\n\t\t\t}),\n\t\t\tannotationsTemp = this.state.annotations.filter((e) => {\n\t\t\t\treturn e.textId != id\n\t\t\t})\n\t\tvar filterAnnotation = this.state.annotations.filter((e) => {\n\t\t\treturn e.textId == id\n\t\t})[0];\n\t\tthis.state.ctx.beginPath();\n\t\tthis.state.ctx.clearRect(filterAnnotation.location.startX,\n\t\t\tfilterAnnotation.location.startY,\n\t\t\tfilterAnnotation.location.endX - filterAnnotation.location.startX,\n\t\t\tfilterAnnotation.location.endY - filterAnnotation.location.startY\n\t\t);\n\t\tthis.state.ctx.closePath();\n\t\tthis.handleDeleLineToText(id);\n\n\t\tthis.setState({\n\t\t\ttextDivs: textDivsTemp,\n\t\t\tannotations: annotationsTemp,\n\t\t\tclearRect: null\n\t\t})\n\t}\n\n\thandleOnColorChanged(color) {\n\t\tthis.setState({\n\t\t\tcolor\n\t\t})\n\t}\n\n\trender() {\n\n\t\tconst annotationCanvasStyle = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 10,\n\t\t\topacity: this.props.opacity,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent'\n\t\t}\n\n\t\tconst annotationLineCanvasStyle = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 5,\n\t\t\topacity: this.props.opacity,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent',\n\t\t}\n\n\t\tconst annotationsInterfaceCanvas = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 15,\n\t\t\topacity: this.props.opacity,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent'\n\t\t}\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<AnnotationToolsMenu colorChangeCallback={this.handleOnColorChanged.bind(this)}/>\n\n\t\t\t\t<canvas ref={(c) => this.canvas = c}\n\t\t\t\t\t\tstyle={annotationCanvasStyle}\n\t\t\t\t/>\n\n\t\t\t\t<canvas ref={(c) => this.interfaceCanvas = c}\n\t\t\t\t\t\tstyle={annotationCanvasStyle}\n\t\t\t\t\t\tonMouseDown={this.handleOnMouseDown.bind(this)}\n\t\t\t\t\t\tonMouseUp={this.handleOnMouseUp.bind(this)}\n\t\t\t\t\t\tonMouseMove={this.handleOnMouseDownMove.bind(this)}\n\t\t\t\t\t\tonContextMenu={this.handleOnContextMenu.bind(this)}\n\t\t\t\t/>\n\n\t\t\t\t<canvas ref={(c) => this.annotationLineCanvas = c} \n\t\t\t\t\t\tstyle={annotationLineCanvasStyle}\n\t\t\t\t\t\t/>\n\n\t\t\t\t<div style={{position:'relative'}}>\n\t\t\t\t\t{this.state.textDivs.map((e) => e)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nAnnotationViewer.defaultProps = {\n\tdecWidth: 250\n}\n\nmodule.exports = AnnotationViewer;"]}