{"version":3,"sources":["../../src/AnnotationEditViewer/AnnotationViewModel.js"],"names":["AnnotationViewModel","props","state","ctx","linesCtx","annotationDivs","textDivs","handleGetDivs","bind","handleDrawAnnotation","action","undefined","console","error","canvas","findDOMNode","annotationLineCanvas","height","Math","floor","viewport","pagesCount","width","lineTextWidth","getContext","setState","result","Promise","resolve","reject","get","end","err","res","body","then","log","annotations","map","annotation","location","endX","startX","endY","startY","beginPath","fillStyle","color","fillRect","closePath","left","textId","decWidth","top","offsetLeft","moveTo","strokeStyle","lineTo","stroke","concat","offsetTop","text","canvasStyle","position","zIndex","opacity","margin","borderLeft","borderRight","borderTop","borderStyle","borderColor","annotationLineCanvasStyle","e","div","module","exports"],"mappings":"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","file":"AnnotationViewModel.js","sourcesContent":["import React, {Component} from 'react';\nimport ReactDOM from 'react-dom';\nimport superagent from 'superagent';\n\nimport AnnotationText from './AnnotationText';\n\nclass AnnotationViewModel extends Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tctx: null,\n\t\t\tlinesCtx: null,\n\t\t\tannotationDivs: [],\n\t\t\ttextDivs: []\n\t\t}\n\n\t\tthis.handleGetDivs = this.handleGetDivs.bind(this);\n\t\tthis.handleDrawAnnotation = this.handleDrawAnnotation.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\n\t\tthis.props.action === undefined ? console.error(\"You must set the props 'action' when use view model!\") : \"\";\n\n\t\tvar canvas = ReactDOM.findDOMNode(this.canvas),\n\t\t\tannotationLineCanvas = ReactDOM.findDOMNode(this.annotationLineCanvas),\n\t\t\theight = Math.floor(this.props.viewport.height * this.props.pagesCount + (this.props.pagesCount - 1) * 9),\n\t\t\twidth = Math.floor(this.props.viewport.width),\n\t\t\tannotationDivs = null;\n\n\t\tcanvas.height = height;\n\t\tcanvas.width = width;\n\n\t\tannotationLineCanvas.height = height;\n\t\tannotationLineCanvas.width = width + this.props.lineTextWidth;\n\n\t\tvar ctx = canvas.getContext(\"2d\"),\n\t\t\tlinesCtx = annotationLineCanvas.getContext(\"2d\");\n\n\t\tthis.setState({\n\t\t\tctx,\n\t\t\tlinesCtx\n\t\t})\n\n\t\tvar result = new Promise((resolve, reject) => {\n\t\t\tsuperagent.get(this.props.action)\n\t\t\t\t\t  .end((err, res) => err ? reject(res.body || err) : resolve(res.body))\n\t\t})\n\t\tresult.then((res) => this.handleGetDivs(res), (err) => console.log(err));\n\t}\n\n\thandleGetDivs(res) {\n\t\tthis.setState({\n\t\t\tannotationDivs: res.annotations\n\t\t})\n\t\tthis.state.annotationDivs.map((annotation) => \n\t\t\t\tthis.handleDrawAnnotation(annotation))\n\t}\n\n\thandleDrawAnnotation(annotation) {\n\t\tvar width = annotation.location.endX - annotation.location.startX,\n\t\t\theight = annotation.location.endY - annotation.location.startY;\n\n\t\tthis.state.ctx.beginPath();\n\t\tthis.state.ctx.fillStyle = annotation.color;\n\t\tthis.state.ctx.fillRect(annotation.location.startX, annotation.location.startY,\n\t\t\t\t\t\t\t\t  width, height);\n\t\tthis.state.ctx.closePath();\n\n\t\tvar left = this.annotationLineCanvas.width - (annotation.textId % 2 == 0 ? 0 : this.props.decWidth),\n\t\t\ttop = annotation.location.endY - (annotation.location.endY - annotation.location.startY) / 2,\n\t\t\toffsetLeft = this.annotationLineCanvas.offsetLeft;\n\n\t\tthis.state.linesCtx.beginPath();\n\t\tthis.state.linesCtx.moveTo(annotation.location.endX, \n\t\t\tannotation.location.endY - (annotation.location.endY - annotation.location.startY) / 2);\n\t\tthis.state.linesCtx.strokeStyle = annotation.color;\n\t\tthis.state.linesCtx.lineTo(left, top);\n\t\tthis.state.linesCtx.stroke();\n\t\tthis.state.linesCtx.closePath();\n\n\t\tthis.setState({\n\t\t\ttextDivs: this.state.textDivs.concat(\n\t\t\t\t<AnnotationText key={annotation.textId} \n\t\t\t\t\tid={annotation.textId}\n\t\t\t\t\ttop={top + this.state.ctx.canvas.offsetTop}\n\t\t\t\t\tleft={left}\n\t\t\t\t\toffsetLeft={offsetLeft}\n\t\t\t\t\tcolor={annotation.color}\n\t\t\t\t\ttext={annotation.text}\n\t\t\t\t/>\n\t\t\t)\n\t\t})\n\t}\n\n\trender() {\n\n\t\tconst canvasStyle = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 10,\n\t\t\topacity: 0.5,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent'\n\t\t}\n\n\t\tconst annotationLineCanvasStyle = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 5,\n\t\t\topacity: 0.5,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent',\n\t\t}\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<canvas ref={(e) => this.canvas = e} \n\t\t\t\t\t\tstyle={canvasStyle}/>\n\t\t\t\t<canvas ref={(e) => this.annotationLineCanvas = e}\n\t\t\t\t\t\tstyle={annotationLineCanvasStyle}/>\n\t\t\t\t{this.state.textDivs.map((div) => div)}\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nmodule.exports = AnnotationViewModel;"]}