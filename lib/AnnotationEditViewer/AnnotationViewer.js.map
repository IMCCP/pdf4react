{"version":3,"sources":["../../src/AnnotationEditViewer/AnnotationViewer.js"],"names":["AnnotationViewer","props","state","startX","startY","ctx","interfaceCtx","linesCtx","mouseDown","clearRect","textDivs","annotations","annotationDivs","textId","color","offsetLeft","offsetTop","viewModel","handlePdfAnnotationModel","bind","model","setState","canvas","findDOMNode","annotationInterfaceCanvas","interfaceCanvas","annotationLineCanvas","height","Math","floor","viewport","pagesCount","width","lineTextWidth","getContext","annotationModel","action","undefined","console","error","e","preventDefault","pageX","pageY","endX","endY","beginPath","closePath","fillStyle","fillRect","handleDrawLineToText","concat","type","location","text","id","Object","assign","left","top","lineStartX","textDivStyle","decWidth","moveTo","lineTo","strokeStyle","stroke","handleOnCloseTextDiv","handleAnnotationDivTextChange","deleLine","lineWidth","textDivsTemp","filter","key","annotationsTemp","filterAnnotation","handleDeleLineToText","annotationCanvasStyle","position","zIndex","opacity","margin","borderLeft","borderRight","borderTop","borderStyle","borderColor","annotationLineCanvasStyle","annotationsInterfaceCanvas","handleOnColorChanged","c","handleOnMouseDown","handleOnMouseUp","handleOnMouseDownMove","handleOnContextMenu","map","defaultProps","module","exports"],"mappings":"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","file":"AnnotationViewer.js","sourcesContent":["import React, {\n\tComponent\n} from 'react';\nimport ReactDOM from 'react-dom';\n\nimport AnnotationText from './AnnotationText';\nimport AnnotationLeftToolsMenu from './AnnotationLeftToolsMenu';\nimport AnnotationRightToolsMenu from './AnnotationRightToolsMenu';\nimport AnnotationViewModel from './AnnotationViewModel';\n\nimport FontFace from '../css/font-face.css';\n\nclass AnnotationViewer extends Component {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tstartX: null,\n\t\t\tstartY: null,\n\t\t\tctx: null,\n\t\t\tinterfaceCtx: null,\n\t\t\tlinesCtx: null,\n\t\t\tmouseDown: false,\n\t\t\tclearRect: null,\n\t\t\ttextDivs: [],\n\t\t\tannotations: [],\n\t\t\tannotationDivs: {},\n\t\t\ttextId: 0,\n\t\t\tcolor: 'rgba(0, 128, 0, 0.5)',\n\t\t\toffsetLeft: null,\n\t\t\toffsetTop: null,\n\t\t\tviewModel: false,\n\t\t}\n\t\tthis.handlePdfAnnotationModel = this.handlePdfAnnotationModel.bind(this);\n\t}\n\n\tcomponentDidMount() {\n\t\tswitch(this.props.model) {\n\t\t\tcase 'view':\n\t\t\t\tthis.setState({viewModel: true});\n\t\t\t\tbreak;\n\t\t\tcase 'annotation':\n\t\t\t\tthis.setState({viewModel: false});\n\t\t\t\tthis.handlePdfAnnotationModel();\n\t\t\t\tbreak;\n\t\t\tdefault: break;\n\t\t}\n\t}\n\n\thandlePdfAnnotationModel() {\n\t\tvar canvas = ReactDOM.findDOMNode(this.canvas),\n\t\t\tannotationInterfaceCanvas = ReactDOM.findDOMNode(this.interfaceCanvas),\n\t\t\tannotationLineCanvas = ReactDOM.findDOMNode(this.annotationLineCanvas),\n\t\t\theight = Math.floor(this.props.viewport.height * this.props.pagesCount + (this.props.pagesCount - 1) * 9),\n\t\t\twidth = Math.floor(this.props.viewport.width);\n\n\t\tcanvas.height = height;\n\t\tcanvas.width = width;\n\n\t\tannotationInterfaceCanvas.height = height;\n\t\tannotationInterfaceCanvas.width = width;\n\n\t\tannotationLineCanvas.height = height;\n\t\tannotationLineCanvas.width = width + this.props.lineTextWidth;\n\n\t\tvar ctx = canvas.getContext(\"2d\"),\n\t\t\tlinesCtx = annotationLineCanvas.getContext(\"2d\"),\n\t\t    interfaceCanvas = annotationInterfaceCanvas.getContext(\"2d\");\n\n\t\tthis.setState({\n\t\t\tctx,\n\t\t\toffsetLeft: canvas.width + 20,\n\t\t\toffsetTop: canvas.offsetTop + 10,\n\t\t\tlinesCtx,\n\t\t\tinterfaceCanvas,\n\t\t\tannotationModel: true\n\t\t});\n\n\t\tif (this.props.action === undefined) {\n\t\t\tconsole.error(\"You must set the props 'action' when use annotation model!\")\n\t\t}\n\t}\n\n\thandleOnMouseDown(e) {\n\t\te.preventDefault();\n\t\tthis.setState({\n\t\t\tstartX: e.pageX - this.canvas.offsetLeft,\n\t\t\tstartY: e.pageY - 9 - this.canvas.offsetTop,\n\t\t\tmouseDown: true\n\t\t})\n\t}\n\n\thandleOnMouseUp(e) {\n\t\tvar endX = e.pageX - this.canvas.offsetLeft,\n\t\t\tendY = e.pageY - 9 - this.canvas.offsetTop;\n\n\t\tif (this.state.startX != endX && this.state.startY != endY && this.state.mouseDown) {\n\t\t\tthis.state.interfaceCanvas.beginPath();\n\t\t\tthis.state.interfaceCanvas.clearRect(0, 0, this.interfaceCanvas.width, this.interfaceCanvas.height);\n\t\t\tthis.state.interfaceCanvas.closePath();\n\n\t\t\tthis.state.ctx.beginPath();\n\t\t\tthis.state.ctx.fillStyle = this.state.color;\n\t\t\tthis.state.ctx.fillRect(this.state.startX, this.state.startY,\n\t\t\t\tendX - this.state.startX, endY - this.state.startY);\n\t\t\tthis.state.ctx.closePath();\n\t\t\tthis.handleDrawLineToText(this.state.startX, this.state.startY,\n\t\t\t\tendX, endY);\n\n\t\t\tthis.setState({\n\t\t\t\tannotations: this.state.annotations.concat({\n\t\t\t\t\ttype: 'rect',\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\tstartX: this.state.startX,\n\t\t\t\t\t\tstartY: this.state.startY,\n\t\t\t\t\t\tendX: endX,\n\t\t\t\t\t\tendY: endY\n\t\t\t\t\t},\n\t\t\t\t\ttextId: this.state.textId,\n\t\t\t\t\tcolor: this.state.color\n\t\t\t\t}),\n\t\t\t\tmouseDown: false,\n\t\t\t\ttextId: this.state.textId + 1,\n\t\t\t\tclearRect: null\n\t\t\t})\n\t\t}\n\t}\n\n\thandleOnMouseDownMove(e) {\n\t\tif (this.state.mouseDown) {\n\t\t\tvar endX = e.pageX - this.canvas.offsetLeft - this.state.startX,\n\t\t\t\tendY = e.pageY - this.canvas.offsetTop - 9 - this.state.startY;\n\t\t\tthis.state.interfaceCanvas.beginPath();\n\t\t\tif (this.state.clearRect != null) {\n\t\t\t\tthis.state.interfaceCanvas.clearRect(this.state.clearRect[0], this.state.clearRect[1],\n\t\t\t\t\tthis.state.clearRect[2], this.state.clearRect[3])\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.state.interfaceCanvas.fillStyle = this.state.color;\n\t\t\tthis.state.interfaceCanvas.fillRect(this.state.startX, this.state.startY,\n\t\t\t\tendX, endY);\n\t\t\tthis.state.interfaceCanvas.closePath();\n\t\t}\n\t}\n\n\thandleAnnotationDivTextChange(text, id) {\n\t\tthis.setState({\n\t\t\tannotationDivs: Object.assign({\n\t\t\t\t...this.state.annotationDivs,\n\t\t\t\t[id]: {\n\t\t\t\t\tleft: this.state.annotationDivs[id].left,\n\t\t\t\t\ttop: this.state.annotationDivs[id].top,\n\t\t\t\t\tlineStartX: this.state.annotationDivs[id].lineStartX,\n\t\t\t\t\ttext: text\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\thandleDrawLineToText(startX, startY, endX, endY) {\n\t\tvar textDivStyle = {},\n\t\t\toffsetLeft = this.annotationLineCanvas.offsetLeft,\n\t\t\tlineStartX = startX > endX ? startX : endX;\n\t\ttextDivStyle.left = this.annotationLineCanvas.width - (this.state.textId % 2 == 0 ? 0 : this.props.decWidth);\n\t\ttextDivStyle.top = endY - (endY - startY) / 2;\n\n\t\tthis.state.linesCtx.beginPath();\n\t\tthis.state.linesCtx.moveTo(lineStartX, endY - (endY - startY) / 2);\n\t\tthis.state.linesCtx.lineTo(textDivStyle.left, textDivStyle.top);\n\t\tthis.state.linesCtx.strokeStyle = this.state.color;\n\t\tthis.state.linesCtx.stroke();\n\t\tthis.state.linesCtx.closePath();\n\n\t\tthis.setState({\n\t\t\ttextDivs: this.state.textDivs.concat(\n\t\t\t\t<AnnotationText key={this.state.textId} \n\t\t\t\t\tid={this.state.textId}\n\t\t\t\t\tleft={textDivStyle.left} \n\t\t\t\t\ttop={textDivStyle.top} \n\t\t\t\t\toffsetLeft={offsetLeft}\n\t\t\t\t\tcolor={this.state.color}\n\t\t\t\t\teditModel={true}\n\t\t\t\t\tonCloseTextDiv={this.handleOnCloseTextDiv.bind(this)}\n\t\t\t\t\tonChange={this.handleAnnotationDivTextChange.bind(this)}/>),\n\t\t\tannotationDivs: Object.assign({}, {\n\t\t\t\t...this.state.annotationDivs,\n\t\t\t\t[this.state.textId]: {\n\t\t\t\t\tleft: textDivStyle.left,\n\t\t\t\t\ttop: textDivStyle.top,\n\t\t\t\t\tlineStartX: lineStartX\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\thandleDeleLineToText(id) {\n\t\tvar deleLine = this.state.annotationDivs[id];\n\t\tthis.state.linesCtx.beginPath();\n\t\tthis.state.linesCtx.clearRect(deleLine.lineStartX, deleLine.top - this.state.linesCtx.lineWidth,\n\t\t\tdeleLine.left, this.state.linesCtx.lineWidth * 2);\n\t\tthis.state.linesCtx.closePath();\n\t}\n\n\thandleOnContextMenu(e) {\n\t\te.preventDefault();\n\t\tif (this.state.mouseDown) {\n\t\t\tvar endX = e.pageX - this.canvas.offsetLeft - this.state.startX,\n\t\t\t\tendY = e.pageY - this.canvas.offsetTop - 9 - this.state.startY;\n\t\t\tif (this.state.clearRect != null) {\n\t\t\t\tthis.state.ctx.beginPath();\n\t\t\t\tthis.state.ctx.clearRect(this.state.clearRect[0], this.state.clearRect[1],\n\t\t\t\t\tthis.state.clearRect[2], this.state.clearRect[3])\n\t\t\t\tthis.state.ctx.closePath();\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.setState({\n\t\t\t\t\tclearRect: [this.state.startX, this.state.startY, endX, endY]\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tthis.setState({\n\t\t\tmouseDown: false\n\t\t})\n\t}\n\n\thandleOnCloseTextDiv(id) {\n\n\t\tvar textDivsTemp = this.state.textDivs.filter((e) => {\n\t\t\t\treturn e.key != id\n\t\t\t}),\n\t\t\tannotationsTemp = this.state.annotations.filter((e) => {\n\t\t\t\treturn e.textId != id\n\t\t\t})\n\t\tvar filterAnnotation = this.state.annotations.filter((e) => {\n\t\t\treturn e.textId == id\n\t\t})[0];\n\t\tthis.state.ctx.beginPath();\n\t\tthis.state.ctx.clearRect(filterAnnotation.location.startX,\n\t\t\tfilterAnnotation.location.startY,\n\t\t\tfilterAnnotation.location.endX - filterAnnotation.location.startX,\n\t\t\tfilterAnnotation.location.endY - filterAnnotation.location.startY\n\t\t);\n\t\tthis.state.ctx.closePath();\n\t\tthis.handleDeleLineToText(id);\n\n\t\tthis.setState({\n\t\t\ttextDivs: textDivsTemp,\n\t\t\tannotations: annotationsTemp,\n\t\t\tclearRect: null\n\t\t})\n\t}\n\n\thandleOnColorChanged(color) {\n\t\tthis.setState({\n\t\t\tcolor\n\t\t})\n\t}\n\n\trender() {\n\n\t\tconst annotationCanvasStyle = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 10,\n\t\t\topacity: this.props.opacity,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent'\n\t\t}\n\n\t\tconst annotationLineCanvasStyle = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 5,\n\t\t\topacity: this.props.opacity,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent',\n\t\t}\n\n\t\tconst annotationsInterfaceCanvas = {\n\t\t\tposition: 'absolute',\n\t\t\tzIndex: 15,\n\t\t\topacity: this.props.opacity,\n\t\t\tmargin: '1px auto -8px auto',\n\t\t\tborderLeft: '0px',\n\t\t\tborderRight: '0px',\n\t\t\tborderTop: '9px',\n\t\t\tborderStyle: 'solid',\n\t\t\tborderColor: 'transparent'\n\t\t}\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t{this.state.viewModel ? \n\t\t\t\t<div>\t\n\t\t\t\t\t<AnnotationViewModel \n\t\t\t\t\t\t\tviewport={this.props.viewport}\n\t\t\t\t\t\t\tpagesCount={this.props.pagesCount}\n\t\t\t\t\t\t\taction={this.props.action}\n\t\t\t\t\t\t\tdecWidth={this.props.decWidth}\n\t\t\t\t\t\t\tlineTextWidth={this.props.lineTextWidth}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t : \n\t\t\t\t<div>\n\t\t\t\t\t<AnnotationLeftToolsMenu colorChangeCallback={this.handleOnColorChanged.bind(this)}/>\n\t\t\t\t\t<AnnotationRightToolsMenu left={this.state.offsetLeft} \n\t\t\t\t\t\t\t\t\t\t  top={this.state.offsetTop} \n\t\t\t\t\t\t\t\t\t\t  annotationDivs={this.state.annotationDivs}\n\t\t\t\t\t\t\t\t\t\t  textDivs={this.state.textDivs}\n\t\t\t\t\t\t\t\t\t\t  annotations={this.state.annotations}\n\t\t\t\t\t\t\t\t\t\t  action={this.props.action}\n\t\t\t\t\t\t\t\t\t\t  />\n\t\t\t\t\n\t\t\t\t\t<canvas ref={(c) => this.canvas = c}\n\t\t\t\t\t\tstyle={annotationCanvasStyle}\n\t\t\t\t\t/>\n\t\t\t\t\t<canvas ref={(c) => this.interfaceCanvas = c}\n\t\t\t\t\t\tstyle={annotationCanvasStyle}\n\t\t\t\t\t\tonMouseDown={this.handleOnMouseDown.bind(this)}\n\t\t\t\t\t\tonMouseUp={this.handleOnMouseUp.bind(this)}\n\t\t\t\t\t\tonMouseMove={this.handleOnMouseDownMove.bind(this)}\n\t\t\t\t\t\tonContextMenu={this.handleOnContextMenu.bind(this)}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<canvas ref={(c) => this.annotationLineCanvas = c} \n\t\t\t\t\t\tstyle={annotationLineCanvasStyle}\n\t\t\t\t\t\t/>\n\t\t\t\t</div> }\n\t\t\t\t<div style={{position:'relative'}}>\n\t\t\t\t\t{this.state.textDivs.map((e) => e)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nAnnotationViewer.defaultProps = {\n\tdecWidth: 250\n}\n\nmodule.exports = AnnotationViewer;"]}